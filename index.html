<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>ç›®å½•ç´¢å¼•</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 20px 24px 40px;
      background: #f5f5f7;
      color: #222;
    }
    h1 {
      font-size: 22px;
      margin: 0 0 4px;
    }
    .path {
      font-size: 13px;
      color: #666;
      margin-bottom: 20px;
      word-break: break-all;
    }
    .card {
      background: #fff;
      border-radius: 12px;
      padding: 16px 18px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.04);
    }
    ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    li {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 4px;
      border-bottom: 1px solid #f0f0f0;
      font-size: 15px;
    }
    li:last-child {
      border-bottom: none;
    }
    a {
      text-decoration: none;
      color: #0066cc;
    }
    a:hover {
      text-decoration: underline;
    }
    .name {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .badge {
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid #e0e0e0;
      color: #666;
    }
    .type-folder {
      color: #ff9800;
      font-weight: 600;
    }
    .type-html {
      color: #4caf50;
    }
    .type-file {
      color: #999;
    }
    .back {
      margin-bottom: 8px;
      font-size: 14px;
    }
    .back a {
      color: #555;
    }
    .loading, .error, .empty {
      font-size: 14px;
      color: #666;
      padding: 4px 0;
    }
    @media (max-width: 600px) {
      body { padding: 16px 12px 32px; }
    }
  </style>
</head>
<body>
  <h1>ç›®å½•ç´¢å¼•</h1>
  <div class="path" id="currentPath"></div>

  <div class="card">
    <div class="back" id="backLink"></div>
    <div id="status" class="loading">åŠ è½½ä¸­...</div>
    <ul id="list"></ul>
  </div>

  <script>
    // === â‘  é…ç½®åŒºåŸŸï¼šè¿™é‡Œæ”¹æˆä½ è‡ªå·±çš„ä»“åº“ä¿¡æ¯ ===
    const CONFIG = {
      owner: "techbobo", // ä½ çš„ GitHub ç”¨æˆ·å
      repo: "demo",        // ä»“åº“å
      branch: "main",                // åˆ†æ”¯åï¼Œä¸€èˆ¬æ˜¯ main æˆ– master æˆ– gh-pages
      basePath: ""                   // å¦‚æœé¡µé¢ä¸åœ¨ä»“åº“æ ¹ç›®å½•ï¼Œå¯å¡«ç›¸å¯¹å­è·¯å¾„ï¼Œå¦‚ "demo"
    };
    // ============================================

    // å·¥å…·å‡½æ•°ï¼šç¼–ç  pathï¼Œé¿å… / è¢«ç¼–ç 
    function encodeGitHubPath(path) {
      if (!path) return "";
      return path
        .split("/")
        .filter(Boolean)
        .map(encodeURIComponent)
        .join("/");
    }

    // æ ¹æ®å½“å‰ URL è§£æâ€œå½“å‰ç›®å½•â€åœ¨ä»“åº“ä¸­çš„ç›¸å¯¹è·¯å¾„
    function getRepoRelativeDirPath() {
      let path = window.location.pathname; // e.g. /repo/sub/dir/index.html æˆ– /sub/dir/index.html
      const repo = CONFIG.repo;

      // å»æ‰å‰é¢çš„ /username.github.io æˆ– /repo è¿™éƒ¨åˆ†
      const idx = path.indexOf("/" + repo + "/");
      if (idx !== -1) {
        // é¡¹ç›®é¡µ: /repo/...
        path = path.slice(idx + repo.length + 2); // è·³è¿‡ "/repo/"
      } else {
        // ç”¨æˆ·ä¸»é¡µ: /... ï¼ˆä»“åº“åé€šå¸¸æ˜¯ username.github.ioï¼‰
        path = path.slice(1);
      }

      // å»æ‰ index.html
      if (path.endsWith("index.html")) {
        path = path.slice(0, -"index.html".length);
      }

      // å»æ‰é¦–å°¾ /
      path = path.replace(/^\/+|\/+$/g, "");

      // è€ƒè™‘ basePath
      if (CONFIG.basePath) {
        const bp = CONFIG.basePath.replace(/^\/+|\/+$/g, "");
        if (!path) {
          path = bp;
        } else if (!path.startsWith(bp)) {
          path = bp + "/" + path;
        }
      }

      return path; // å¯èƒ½æ˜¯ ""ï¼ˆè¡¨ç¤ºä»“åº“æ ¹ç›®å½•ï¼‰ æˆ– "demo" / "demo/sub"
    }

    function getParentPath(path) {
      if (!path) return null;
      const parts = path.split("/").filter(Boolean);
      parts.pop();
      return parts.length ? parts.join("/") : "";
    }

    async function loadDirectory() {
      const dirPath = getRepoRelativeDirPath();
      const nicePath = dirPath || "/";
      document.getElementById("currentPath").textContent =
        "å½“å‰è·¯å¾„ï¼ˆä»“åº“ç›¸å¯¹è·¯å¾„ï¼‰ï¼š " + nicePath;

      const parent = getParentPath(dirPath);
      const backEl = document.getElementById("backLink");
      if (parent !== null) {
        // ç”Ÿæˆè¿”å›ä¸Šä¸€çº§é“¾æ¥ï¼ˆç›¸å¯¹è·¯å¾„ï¼‰
        const backHref = parent === "" ? "./../" : "../";
        backEl.innerHTML = `â¬…ï¸ <a href="${backHref}">è¿”å›ä¸Šä¸€çº§</a>`;
      } else {
        backEl.innerHTML = "";
      }

      const apiPath = encodeGitHubPath(dirPath);
      const apiUrl = `https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${apiPath}?ref=${encodeURIComponent(CONFIG.branch)}`;

      const status = document.getElementById("status");
      const list = document.getElementById("list");
      list.innerHTML = "";
      status.textContent = "åŠ è½½ä¸­...";

      try {
        const res = await fetch(apiUrl);
        if (!res.ok) {
          throw new Error("GitHub API è¿”å›é”™è¯¯çŠ¶æ€ï¼š" + res.status);
        }
        const data = await res.json();
        if (!Array.isArray(data)) {
          throw new Error("è¿”å›æ•°æ®ä¸æ˜¯ç›®å½•åˆ—è¡¨");
        }

        // æŒ‰ type æ’åºï¼šç›®å½•åœ¨å‰ï¼Œç„¶å HTMLï¼Œç„¶åå…¶ä»–æ–‡ä»¶
        const dirs = [];
        const htmlFiles = [];
        const otherFiles = [];
        for (const item of data) {
          if (item.type === "dir") {
            dirs.push(item);
          } else if (
            item.type === "file" &&
            item.name.toLowerCase().endsWith(".html")
          ) {
            htmlFiles.push(item);
          } else if (item.type === "file") {
            otherFiles.push(item);
          }
        }

        const items = [...dirs, ...htmlFiles, ...otherFiles];
        if (items.length === 0) {
          status.textContent = "";
          list.innerHTML = `<li class="empty">å½“å‰ç›®å½•ä¸ºç©º</li>`;
          return;
        }

        status.textContent = "";
        for (const item of items) {
          const li = document.createElement("li");
          const left = document.createElement("div");
          left.className = "name";
          const right = document.createElement("div");
          const a = document.createElement("a");

          if (item.type === "dir") {
            // ç›®å½•ï¼šè·³è½¬åˆ°å­ç›®å½•ï¼ˆç›¸å¯¹é“¾æ¥ï¼Œæµè§ˆå™¨å†åŠ è½½è¯¥ç›®å½•ä¸‹çš„ index.htmlï¼‰
            a.href = "./" + item.name + "/";
            a.textContent = "ğŸ“ " + item.name;
            left.appendChild(a);
            const badge = document.createElement("span");
            badge.className = "badge type-folder";
            badge.textContent = "ç›®å½•";
            right.appendChild(badge);
          } else if (item.type === "file") {
            a.href = "./" + item.name;
            a.textContent = "ğŸ“„ " + item.name;
            left.appendChild(a);

            const badge = document.createElement("span");
            badge.className = "badge " + (
              item.name.toLowerCase().endsWith(".html")
                ? "type-html"
                : "type-file"
            );
            badge.textContent = item.name.toLowerCase().endsWith(".html")
              ? "HTML"
              : "æ–‡ä»¶";
            right.appendChild(badge);
          } else {
            continue;
          }

          li.appendChild(left);
          li.appendChild(right);
          list.appendChild(li);
        }
      } catch (err) {
        console.error(err);
        status.className = "error";
        status.textContent =
          "åŠ è½½å¤±è´¥ï¼š" + err.message + "ï¼ˆæ³¨æ„ï¼šæœ‰ API è®¿é—®é¢‘ç‡é™åˆ¶ï¼‰";
      }
    }

    loadDirectory();
  </script>
</body>
</html>
